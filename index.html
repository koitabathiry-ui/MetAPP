<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MetAPP ‚Äì MALI-METEO</title>

<link rel="manifest" href="manifest.json">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #eef2f3;
}

header {
  background: #0a5275;
  color: white;
  padding: 15px;
  text-align: center;
}

nav {
  display: flex;
  background: white;
  border-bottom: 1px solid #ccc;
}

nav button {
  flex: 1;
  padding: 12px;
  border: none;
  background: none;
  font-weight: bold;
  cursor: pointer;
}

nav button:hover {
  background: #f0f0f0;
}

.page {
  display: none;
  padding: 15px;
}

.page.active {
  display: block;
}

select, textarea, input, audio, a, button {
  width: 100%;
  margin-top: 10px;
}

.admin-box {
  background: #fff;
  border: 1px solid #ccc;
  padding: 10px;
  margin-top: 20px;
}

footer {
  background: #0a5275;
  color: white;
  text-align: center;
  padding: 10px;
}
</style>
</head>

<body>

<header>
  <h1>MetAPP</h1>
  <p>Application officielle ‚Äì MALI-METEO</p>
</header>

<nav>
  <button onclick="showPage('accueil')">Accueil</button>
  <button onclick="showPage('previsions')">Pr√©visions</button>
  <button onclick="showPage('donnees')">Donn√©es</button>
  <button onclick="showPage('archives')">Archives</button>
  <button onclick="showPage('aide')">Aide</button>
</nav>

<main>

<section id="accueil" class="page active">
  <h2>Bienvenue</h2>
  <p>Agence nationale de la m√©t√©orologie au Mali (MALI-METEO)</p>
  <p>Contact : malimeteo@malimeteo.ml</p>
</section>

<section id="previsions" class="page">
  <h2>Pr√©visions m√©t√©orologiques</h2>

  <select id="typePrev" onchange="chargerPrevision()">
    <option value="quotidienne">Quotidienne</option>
    <option value="hebdomadaire">Hebdomadaire</option>
    <option value="saisonniere">Saisonni√®re</option>
  </select>

  <div id="contenuPrev"></div>

  <!-- ===== ADMIN ===== -->
  <div class="admin-box">
    <h3>Administration</h3>

    <textarea id="texteAdmin" placeholder="Texte du bulletin m√©t√©o"></textarea>

    <label>Bulletin PDF</label>
    <input type="file" id="pdfAdmin" accept="application/pdf">

    <label>Audio Bambara (enregistrement direct)</label>
    <button onclick="demarrerEnregistrement()">üéôÔ∏è D√©marrer</button>
    <button onclick="arreterEnregistrement()">‚èπÔ∏è Arr√™ter</button>

    <audio id="previewAudio" controls></audio>

    <button onclick="sauvegarderPrevision()">üíæ Enregistrer le bulletin</button>
  </div>
</section>

<section id="donnees" class="page">
  <h2>Requ√™te de donn√©es</h2>
  <a href="#" onclick="alert('Formulaire √† int√©grer')">Ouvrir le formulaire</a>
</section>

<section id="archives" class="page">
  <h2>Archives m√©t√©o</h2>
</section>

<section id="aide" class="page">
  <h2>Aide & Glossaire</h2>
  <div id="glossaire"></div>
</section>

</main>

<footer>
  ¬© MALI-METEO ‚Äì MetAPP
</footer>

<script>
// ================= NAVIGATION =================
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ================= AUDIO ENREGISTREMENT =================
let mediaRecorder;
let audioChunks = [];
let audioBase64 = "";

function demarrerEnregistrement() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

      mediaRecorder.onstop = () => {
        const blob = new Blob(audioChunks, { type: "audio/webm" });
        const reader = new FileReader();

        reader.onloadend = () => {
          audioBase64 = reader.result;
          document.getElementById("previewAudio").src = audioBase64;
        };

        reader.readAsDataURL(blob);
      };
    })
    .catch(() => alert("Acc√®s au micro refus√© ‚ùå"));
}

function arreterEnregistrement() {
  if (mediaRecorder) mediaRecorder.stop();
}

// ================= ADMIN SAUVEGARDE =================
function sauvegarderPrevision() {
  const type = document.getElementById("typePrev").value;
  const texte = document.getElementById("texteAdmin").value;
  const pdfFile = document.getElementById("pdfAdmin").files[0];

  const data = {
    texte: texte,
    pdf: pdfFile ? URL.createObjectURL(pdfFile) : "",
    audio: audioBase64
  };

  localStorage.setItem("prevision_" + type, JSON.stringify(data));
  alert("Bulletin enregistr√© avec succ√®s ‚úÖ");
  chargerPrevision();
}

// ================= AFFICHAGE UTILISATEUR =================
function chargerPrevision() {
  const type = document.getElementById("typePrev").value;
  const data = JSON.parse(localStorage.getItem("prevision_" + type));

  if (!data) {
    document.getElementById("contenuPrev").innerHTML =
      "<p>Aucune pr√©vision disponible.</p>";
    return;
  }

  document.getElementById("contenuPrev").innerHTML = `
    <p>${data.texte}</p>
    ${data.pdf ? `<a href="${data.pdf}" target="_blank">üìÑ T√©l√©charger le bulletin PDF</a>` : ""}
    ${data.audio ? `<audio controls src="${data.audio}"></audio>` : ""}
  `;
}

// ================= GLOSSAIRE =================
const glossaire = [
  { terme: "Orage", definition: "Perturbation m√©t√©orologique convective." },
  { terme: "Pluie", definition: "Chute de gouttelettes d‚Äôeau." },
  { terme: "Vigilance", definition: "Niveau d‚Äôalerte m√©t√©orologique." }
];

document.getElementById("glossaire").innerHTML =
  glossaire.map(g => `<p><strong>${g.terme}</strong> : ${g.definition}</p>`).join("");

chargerPrevision();

// ================= SERVICE WORKER =================
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
